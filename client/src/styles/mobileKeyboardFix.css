/* 
 * Styles pour corriger l'affichage sur mobile avec clavier virtuel
 * Problème: Quand le clavier s'ouvre, un espace blanc apparaît entre le clavier et la zone de saisie.
 * Solution: Position précise de la zone de saisie directement au-dessus du clavier.
 */

/* Variables pour la gestion des hauteurs */
:root {
  --keyboard-height: 0px; /* Hauteur du clavier virtuel */
  --header-height: 56px; /* Hauteur fixe du header */
  --composer-height: 60px; /* Hauteur de la zone de saisie */
  --viewport-height-diff: 0px; /* Différence de hauteur quand le clavier est ouvert */
  --safe-area-top: env(safe-area-inset-top, 0px);
  --safe-area-bottom: env(safe-area-inset-bottom, 0px);
}

/* Structure de base */
html, body {
  overflow: hidden;
  height: 100%;
  width: 100%;
  max-height: 100%;
}

/* Header toujours visible au sommet */
#kora-header-container {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  z-index: 10000 !important;
  height: var(--header-height) !important;
}

/* Zone de message scrollable */
.messages-container {
  position: fixed;
  top: var(--header-height);
  bottom: var(--composer-height);
  left: 0;
  right: 0;
  overflow-y: auto;
  overflow-x: hidden;
  -webkit-overflow-scrolling: touch; /* Défilement fluide sur iOS */
  padding-bottom: 16px; /* Petit espacement au bas des messages */
}

/* Zone de saisie fixée en bas */
.composer-container {
  position: fixed !important;
  bottom: 0 !important;
  left: 0 !important;
  right: 0 !important;
  z-index: 9990 !important;
  background-color: var(--background, #ffffff) !important;
  border-top: 1px solid rgba(0, 0, 0, 0.1);
  padding: 8px !important;
}

/* ÉTAT: Clavier ouvert - ajustements universels pour tous les appareils */
body.keyboard-open .composer-container {
  transform: translateY(calc(var(--keyboard-height) * -1)) !important;
  transition: transform 0.15s ease-out !important;
  /* Évite le saut d'animation */
  will-change: transform;
}

/* ÉTAT: Clavier ouvert - ajustements généraux pour la zone de messages */
body.keyboard-open .messages-container {
  bottom: 0; /* Permettre le défilement complet de la zone de message */
  padding-bottom: calc(var(--composer-height) + var(--keyboard-height)); /* Espace pour la zone de saisie + clavier */
}

/* ÉTAT: Clavier ouvert avec Visual Viewport API */
.visual-viewport-supported.keyboard-open .composer-container {
  transform: translateY(calc(var(--viewport-height-diff) * -1)) !important;
}

/* Optimisation pour les formulaires et champs de saisie */
.chat-textarea {
  resize: none !important;
  overflow-y: auto !important;
  min-height: 40px !important;
  max-height: 120px !important;
  padding: 8px !important;
  width: 100% !important;
}

/* État d'ouverture du clavier - désactive le scroll du body */
body.keyboard-open {
  overflow: hidden !important;
  position: fixed !important;
  width: 100% !important;
  height: 100% !important;
  touch-action: none !important;
}

/* Optimisation Visual Viewport */
@supports (height: 100dvh) {
  body.keyboard-open .messages-container {
    max-height: 100dvh !important;
    height: 100dvh !important;
  }
}

/* Support pour les modèles avec notch */
.ios-notch.keyboard-open #kora-header-container {
  padding-top: var(--safe-area-top) !important;
}

/* Correction pour éviter l'espace blanc */
body.keyboard-open .composer-container {
  box-shadow: 0 -4px 10px rgba(0, 0, 0, 0.05) !important; /* Ombre subtile pour démarquer */
  backface-visibility: hidden !important; /* Optimisation de rendu */
  will-change: transform !important; /* Optimisation des performances */
  margin-bottom: 0 !important; /* Supprime toute marge qui pourrait créer un espace */
  padding-bottom: 0 !important; /* Supprime tout padding qui pourrait créer un espace */
  transform-style: preserve-3d !important; /* Force le rendu hardware pour éviter les glitches */
}

/* Style optimal unifié pour tous les appareils supportant translate3d */
@supports (transform: translate3d(0,0,0)) {
  body.keyboard-open .composer-container {
    transform: translate3d(0, calc(var(--keyboard-height) * -1 - 1px), 0) !important;
  }
}

/* Fix pour s'assurer que la zone de saisie est directement accolée au clavier */
body.keyboard-open .chat-textarea {
  margin-bottom: 0 !important;
  padding-bottom: 8px !important;
  border-bottom-left-radius: 0 !important;
  border-bottom-right-radius: 0 !important;
}

/* Transitions fluides pour améliorer l'expérience utilisateur */
.composer-container {
  transition: transform 0.15s ease-out !important;
}

/* Support pour les appareils plus anciens */
@media (max-width: 640px) {
  .composer-container, 
  body.keyboard-open .composer-container {
    padding: 6px !important;
  }
  
  .chat-textarea {
    min-height: 36px !important;
    padding: 6px !important;
  }
}