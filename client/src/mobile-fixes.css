/* Correctifs pour les problèmes d'interface mobile */

/* Configuration globale pour le comportement mobile */
html {
  height: 100%;
  overflow: hidden;
  width: 100%;
}

body {
  height: 100%;
  width: 100%;
  overflow: hidden;
}

/* Wrapper global pour le viewport mobile */
#root {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

/* Correctifs pour la visibilité d'éléments fixes lorsque le clavier virtuel est ouvert */
.fixed-header {
  position: fixed !important; /* Forcer fixed même si d'autres styles sont appliqués */
  top: 0;
  left: 0;
  right: 0;
  z-index: 9999 !important; /* Z-index très élevé pour garantir la visibilité */
  padding-top: env(safe-area-inset-top, 0);
  transition: none !important; /* Éviter les transitions qui peuvent causer des problèmes */
  /* Optimisations pour les performances */
  will-change: transform;
  -webkit-backface-visibility: hidden;
  -webkit-perspective: 1000;
  -webkit-transform: translate3d(0,0,0);
  transform: translate3d(0,0,0);
}

.input-bar-fixed {
  position: fixed !important; /* Forcer fixed même si d'autres styles sont appliqués */
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 9998 !important; /* Z-index très élevé mais inférieur à l'en-tête */
  padding-bottom: env(safe-area-inset-bottom, 0);
  transition: none !important; /* Éviter les transitions qui peuvent causer des problèmes */
  /* Optimisations pour les performances */
  will-change: transform;
  -webkit-backface-visibility: hidden;
  -webkit-perspective: 1000;
  -webkit-transform: translate3d(0,0,0);
  transform: translate3d(0,0,0);
}

/* Rendre la zone de messages défilable */
.messages-container {
  position: absolute !important;
  top: 64px !important; /* Hauteur de l'en-tête */
  bottom: 170px !important; /* Espace pour la barre de saisie et ses contrôles */
  left: 0;
  right: 0;
  overflow-y: scroll !important; /* Forcer le défilement même sur un petit contenu */
  -webkit-overflow-scrolling: touch; /* Défilement fluide sur iOS */
  /* Rétablir le défilement normal */
  overflow: auto;
  overflow-x: hidden;
  padding-bottom: 1rem;
  /* Fixes pour éviter les problèmes de défilement */
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
}

/* Ajustements spécifiques aux appareils iOS */
@supports (-webkit-touch-callout: none) {
  /* Utilisation de la hauteur disponible sur iOS */
  body, html {
    height: -webkit-fill-available;
  }
  
  #root {
    height: -webkit-fill-available;
  }
  
  /* Éviter problèmes de viewport sur iOS */
  .fixed-header {
    position: fixed !important;
    /* Solution contournant les problèmes d'iOS avec le clavier virtuel */
    -webkit-transform: translateY(0) translateZ(0);
    transform: translateY(0) translateZ(0);
    /* Utiliser les safe areas d'iOS */
    padding-top: env(safe-area-inset-top, 0);
  }
  
  .input-bar-fixed {
    position: fixed !important;
    /* Solution contournant les problèmes d'iOS avec le clavier virtuel */
    -webkit-transform: translateY(0) translateZ(0);
    transform: translateY(0) translateZ(0);
    /* Utiliser les safe areas d'iOS */
    padding-bottom: env(safe-area-inset-bottom, 0);
  }
  
  /* Assurer que la zone de messages est défilable sur iOS */
  .messages-container {
    -webkit-overflow-scrolling: touch !important;
    height: auto !important;
    /* Rendre le défilement plus réactif */
    -webkit-transform: translateZ(0);
    transform: translateZ(0);
    /* Mieux supporter le surscroll bounce d'iOS */
    overscroll-behavior-y: contain;
  }
  
  /* Fix pour le 100vh sur iOS qui peut être problématique */
  .h-full, .h-screen {
    height: -webkit-fill-available;
  }
}